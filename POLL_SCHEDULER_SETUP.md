# –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –æ—Ç–ø—Ä–∞–≤–∫–∏ –æ–ø—Ä–æ—Å–æ–≤

## –ü—Ä–æ–±–ª–µ–º–∞
–û–ø—Ä–æ—Å—ã –¥–æ–ª–∂–Ω—ã –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≤ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è –±–µ–∑ —Ä—É—á–Ω–æ–≥–æ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è.

## –†–µ—à–µ–Ω–∏–µ
–ò—Å–ø–æ–ª—å–∑—É–µ–º –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–µ **Yandex Cloud Timer Triggers** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ –≤—ã–∑–æ–≤–∞ –≤–æ—Ä–∫–µ—Ä–∞ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É.

---

## üöÄ –ê–í–¢–û–ú–ê–¢–ò–ß–ï–°–ö–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê (–†–ï–ö–û–ú–ï–ù–î–£–ï–¢–°–Ø)

### –í–∞—Ä–∏–∞–Ω—Ç 1: Bash-—Å–∫—Ä–∏–ø—Ç (Linux/MacOS)
```bash
chmod +x setup_trigger.sh
./setup_trigger.sh
```

### –í–∞—Ä–∏–∞–Ω—Ç 2: Python-—Å–∫—Ä–∏–ø—Ç (–ª—é–±–∞—è –û–°)
```bash
python3 setup_trigger.py
```

**–ß—Ç–æ –¥–µ–ª–∞–µ—Ç —Å–∫—Ä–∏–ø—Ç:**
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —É—Å—Ç–∞–Ω–æ–≤–∫—É Yandex CLI
- ‚úÖ –ü–æ–ª—É—á–∞–µ—Ç –Ω—É–∂–Ω—ã–µ ID –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏  
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç —Å–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ)
- ‚úÖ –°–æ–∑–¥–∞—ë—Ç Timer Trigger —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –Ω–∞—Å—Ç—Ä–æ–π–∫–∞–º–∏
- ‚úÖ –ü—Ä–æ–≤–µ—Ä—è–µ—Ç —Å—É—â–µ—Å—Ç–≤—É—é—â–∏–µ —Ç—Ä–∏–≥–≥–µ—Ä—ã

**–¢—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω–Ω—ã–π Yandex CLI (`yc`)
- –í—ã–ø–æ–ª–Ω–µ–Ω–Ω–∞—è –∞–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è (`yc init`)

---

## ‚öôÔ∏è –†–£–ß–ù–ê–Ø –ù–ê–°–¢–†–û–ô–ö–ê

### 1. –£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ Yandex CLI (–µ—Å–ª–∏ –µ—â—ë –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω)
```bash
curl -sSL https://storage.yandexcloud.net/yandexcloud-yc/install.sh | bash
source ~/.bashrc
yc init
```

### 2. –°–æ–∑–¥–∞–π—Ç–µ Timer Trigger

```bash
# –ü–æ–ª—É—á–∏—Ç–µ SERVICE_ACCOUNT_ID
yc iam service-account list

# –°–æ–∑–¥–∞–π—Ç–µ —Ç—Ä–∏–≥–≥–µ—Ä —Å webhook (–Ω–µ —Ç—Ä–µ–±—É–µ—Ç function ID)
yc serverless trigger create timer \
  --name poll-scheduler-timer \
  --cron-expression '*/1 * * * ? *' \
  --invoke-function-service-account-id <YOUR_SERVICE_ACCOUNT_ID> \
  --invoke-http \
  --http-method POST \
  --http-url "https://functions.poehali.dev/6937f818-f5ef-4075-afb4-48594cb1a442" \
  --description "–ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è –æ—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω—ã—Ö –æ–ø—Ä–æ—Å–æ–≤ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É"
```

### 3. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ —á—Ç–æ —Ç—Ä–∏–≥–≥–µ—Ä —Å–æ–∑–¥–∞–Ω
```bash
yc serverless trigger list
```

---

## üñ•Ô∏è –ù–ê–°–¢–†–û–ô–ö–ê –ß–ï–†–ï–ó –í–ï–ë-–ö–û–ù–°–û–õ–¨

1. –û—Ç–∫—Ä–æ–π—Ç–µ [Yandex Cloud Console](https://console.cloud.yandex.ru)
2. –ü–µ—Ä–µ–π–¥–∏—Ç–µ –≤ **Cloud Functions ‚Üí –¢—Ä–∏–≥–≥–µ—Ä—ã**
3. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä**
4. –í—ã–±–µ—Ä–∏—Ç–µ —Ç–∏–ø: **Timer (–¢–∞–π–º–µ—Ä)**
5. –£–∫–∞–∂–∏—Ç–µ:
   - **–ò–º—è**: `poll-scheduler-timer`
   - **Cron-–≤—ã—Ä–∞–∂–µ–Ω–∏–µ**: `*/1 * * * ? *` (–∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É)
   - **–í—ã–∑—ã–≤–∞–µ–º—ã–π —Ä–µ—Å—É—Ä—Å**: HTTP-–∑–∞–ø—Ä–æ—Å
   - **HTTP-–º–µ—Ç–æ–¥**: POST
   - **URL**: `https://functions.poehali.dev/6937f818-f5ef-4075-afb4-48594cb1a442`
   - **–°–µ—Ä–≤–∏—Å–Ω—ã–π –∞–∫–∫–∞—É–Ω—Ç**: –í—ã–±–µ—Ä–∏—Ç–µ –∏–∑ —Å–ø–∏—Å–∫–∞ (–Ω—É–∂–Ω–∞ —Ä–æ–ª—å `functions.functionInvoker`)
6. –ù–∞–∂–º–∏—Ç–µ **–°–æ–∑–¥–∞—Ç—å**

---

## ‚úÖ –ü–†–û–í–ï–†–ö–ê –†–ê–ë–û–¢–´

–ü–æ—Å–ª–µ —Å–æ–∑–¥–∞–Ω–∏—è —Ç—Ä–∏–≥–≥–µ—Ä–∞ –æ–ø—Ä–æ—Å—ã –±—É–¥—É—Ç –æ—Ç–ø—Ä–∞–≤–ª—è—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É.

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ CLI:
```bash
yc serverless function logs poll-scheduler-worker --follow
```

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ —á–µ—Ä–µ–∑ –≤–µ–±-–∫–æ–Ω—Å–æ–ª—å:
**Cloud Functions ‚Üí poll-scheduler-worker ‚Üí –õ–æ–≥–∏**

### –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö:
```sql
SELECT id, poll_question, scheduled_time, status, sent_at 
FROM scheduled_polls 
WHERE status = 'sent' 
ORDER BY sent_at DESC 
LIMIT 10;
```

---

## üîß –¢–ï–•–ù–ò–ß–ï–°–ö–ò–ï –î–ï–¢–ê–õ–ò

- **Worker URL**: `https://functions.poehali.dev/6937f818-f5ef-4075-afb4-48594cb1a442`
- **Trigger Cron**: `*/1 * * * ? *` - –∫–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É
- **–õ–æ–≥–∏–∫–∞**: Worker –ø—Ä–æ–≤–µ—Ä—è–µ—Ç –±–∞–∑—É –¥–∞–Ω–Ω—ã—Ö –Ω–∞ –Ω–∞–ª–∏—á–∏–µ –æ–ø—Ä–æ—Å–æ–≤ —Å–æ `status='pending'` –∏ `scheduled_time <= NOW()`
- **SQL-–∑–∞–ø—Ä–æ—Å**: `SELECT ... FROM scheduled_polls WHERE status = 'pending' AND scheduled_time <= NOW()::timestamp`

---

## üåê –ê–õ–¨–¢–ï–†–ù–ê–¢–ò–í–ê: –í–ù–ï–®–ù–ò–ô CRON-–°–ï–†–í–ò–°

–ï—Å–ª–∏ –Ω–µ —Ö–æ—Ç–∏—Ç–µ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å Yandex Cloud Triggers, –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≤–Ω–µ—à–Ω–∏–π cron-—Å–µ—Ä–≤–∏—Å:

**–†–µ–∫–æ–º–µ–Ω–¥—É–µ–º—ã–µ —Å–µ—Ä–≤–∏—Å—ã:**
- [cron-job.org](https://cron-job.org) - –±–µ—Å–ø–ª–∞—Ç–Ω–æ, –º–∏–Ω–∏–º–∞–ª—å–Ω—ã–π –∏–Ω—Ç–µ—Ä–≤–∞–ª 1 –º–∏–Ω—É—Ç–∞
- [EasyCron](https://www.easycron.com) - –±–µ—Å–ø–ª–∞—Ç–Ω–æ –¥–æ 1000 –∑–∞–¥–∞—á/–º–µ—Å—è—Ü
- [UptimeRobot](https://uptimerobot.com) - –º–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ + –≤—ã–∑–æ–≤ URL

**–ù–∞—Å—Ç—Ä–æ–π–∫–∞:**
- **URL –¥–ª—è –≤—ã–∑–æ–≤–∞**: `https://functions.poehali.dev/3f3ec925-eb26-4cb8-b957-7c54490ccc71`
- **–ú–µ—Ç–æ–¥**: POST
- **–ß–∞—Å—Ç–æ—Ç–∞**: –ö–∞–∂–¥—É—é –º–∏–Ω—É—Ç—É (`* * * * *`)
- **–≠—Ç–æ—Ç URL** –≤—ã–∑—ã–≤–∞–µ—Ç –≤–æ—Ä–∫–µ—Ä –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏

---

## üéØ –ò–¢–û–ì

–ü–æ—Å–ª–µ –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è –ª—é–±–æ–≥–æ –∏–∑ –≤—ã—à–µ–ø–µ—Ä–µ—á–∏—Å–ª–µ–Ω–Ω—ã—Ö —Å–ø–æ—Å–æ–±–æ–≤:

‚úÖ –û–ø—Ä–æ—Å—ã –æ—Ç–ø—Ä–∞–≤–ª—è—é—Ç—Å—è **–ø–æ–ª–Ω–æ—Å—Ç—å—é –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏**  
‚úÖ **–ë–µ–∑ —Ç–≤–æ–µ–≥–æ —É—á–∞—Å—Ç–∏—è**  
‚úÖ **–¢–æ—á–Ω–æ –≤ –∑–∞–ø–ª–∞–Ω–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –≤—Ä–µ–º—è** (¬± 1 –º–∏–Ω—É—Ç–∞)  
‚úÖ –°–∏—Å—Ç–µ–º–∞ —Ä–∞–±–æ—Ç–∞–µ—Ç **24/7**

---

**–í—ã–±–µ—Ä–∏ –æ–¥–∏–Ω –∏–∑ —Å–ø–æ—Å–æ–±–æ–≤ –∏ –∑–∞–ø—É—Å—Ç–∏!** –†–µ–∫–æ–º–µ–Ω–¥—É—é –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π —Å–∫—Ä–∏–ø—Ç - –æ–Ω –¥–µ–ª–∞–µ—Ç –≤—Å—ë –∑–∞ 30 —Å–µ–∫—É–Ω–¥.
